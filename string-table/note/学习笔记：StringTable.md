# å­—ç¬¦ä¸²çš„å‰ç”Ÿä»Šä¸–

## å¦‚ä½•å‡ºç”Ÿ

å­—ç¬¦ä¸²çš„6ç§åˆ›å»ºæ–¹å¼

* ä½¿ç”¨`charæ•°ç»„é…åˆnewæ¥åˆ›å»º
* ä½¿ç”¨byteæ•°ç»„é…åˆnewæ¥åˆ›å»º
* ä½¿ç”¨intæ•°ç»„é…åˆnewæ¥åˆ›å»º
* ä½¿ç”¨å·²æœ‰å­—ç¬¦ä¸²é…åˆnewæ¥åˆ›å»º
* ä½¿ç”¨å­—é¢é‡åˆ›å»º
* ä½¿ç”¨+è¿ç®—ç¬¦æ‹¼æ¥åˆ›å»ºå­—ç¬¦ä¸²

## charæ•°ç»„åˆ›å»º

> æ³¨æ„ï¼šä»Java9å¼€å§‹ï¼ŒStringçš„å†…éƒ¨ç»“æ„ç”±`char[]`å˜æˆäº†`byte[]`ã€‚

æœ€åŸºæœ¬çš„åˆ›å»ºæ–¹å¼ï¼Œå› ä¸ºå­—ç¬¦ä¸²å°±æ˜¯å°†å­—ç¬¦ä¸²æ¥èµ·æ¥ã€‚

```
String s = new String(new char[]{'a', 'b', 'c'});
```

å®ƒçš„å†…éƒ¨ç»“æ„å¦‚ä¸‹ï¼ˆJava8ï¼‰ï¼š

![](å­¦ä¹ ç¬”è®°ï¼šStringTable.assets/0d8aa148.png)

å…¶ä¸­ï¼Œ97å…¶å®å°±æ˜¯'a'ï¼Œ98å…¶å®å°±æ˜¯'b'ï¼Œ99éª‘å£«å°±æ˜¯'c'ã€‚ï¼ˆæ ¹æ®Unicodeç¼–ç è¡¨ï¼‰

## byteæ•°ç»„åˆ›å»º

> æ³¨æ„ï¼šä»Java9å¼€å§‹ï¼ŒStringçš„å†…éƒ¨ç»“æ„ç”±`char[]`å˜æˆäº†`byte[]`ã€‚

ä»ç½‘ç»œä¼ é€’è¿‡æ¥çš„æ•°æ®ï¼Œæˆ–æ˜¯é€šè¿‡IOè¯»å–åˆ°çš„æ•°æ®ï¼Œéƒ½æœ‰ä»byteæ•°ç»„è½¬åŒ–ä¸ºå­—ç¬¦ä¸²çš„éœ€æ±‚ã€‚

```
String s = new String(new byte[]{97,98,99});
```

ä¸Šè¿°çš„`new byte[]{97, 98, 99}`å°±å¯ä»¥æ˜¯ï¼š

* ä»ç½‘ç»œï¼ˆä¾‹å¦‚ä¸€ä¸ªæµè§ˆå™¨çš„httpè¯·æ±‚ï¼‰ä¼ é€’è¿‡æ¥çš„å­—èŠ‚æ•°æ®ã€‚
* ä»IOï¼ˆä¾‹å¦‚ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼‰è¯»å–åˆ°çš„æ•°æ®ã€‚

å®ƒçš„å†…éƒ¨ç»“æ„å…¶å®ä¸ç”±charæ•°ç»„åˆ›å»ºçš„æƒ…å†µæ˜¯ä¸€æ ·çš„ï¼Œ`byte[]`ä¼šåœ¨æ„é€ æ—¶è¢«è½¬åŒ–ä¸º`char[]`ã€‚

![](å­¦ä¹ ç¬”è®°ï¼šStringTable.assets/0d8aa148.png)

ä¸€ä¸ªbyteå 1ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªcharå¯èƒ½å 1~3ä¸ªå­—èŠ‚ï¼ˆUTF-8ï¼‰ï¼Œä¹Ÿå¯èƒ½å 2ä¸ªå­—èŠ‚ï¼ˆUTF-16ï¼‰ã€‚

Javaä¸­çš„charå­—ç¬¦éƒ½æ˜¯ä»¥unicodeç¼–ç çš„ã€‚

## intæ•°ç»„åˆ›å»º

æœ‰æ—¶å€™æˆ‘ä»¬è¿˜éœ€è¦ç”¨ä¸¤ä¸ªcharè¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œæ¯”å¦‚ emojiè¡¨æƒ…ğŸ˜‚ï¼Œå®ƒç”¨unicodeç¼–ç è¡¨ç¤ºä¸º0x1F602ï¼Œå­˜å‚¨èŒƒå›´å·²ç»è¶…è¿‡äº†charèƒ½è¡¨ç¤ºçš„æœ€å¤§å€¼0xFFFFï¼Œå› æ­¤éœ€è¦ä½¿ç”¨int[]æ¥æ„é€ è¿™æ ·çš„å­—ç¬¦ä¸²ï¼Œå¦‚ä¸‹ï¼š

```
String s = new String(new int[]{0x1F602},0,1);
```

è½¬æ¢è¿‡ç¨‹å¦‚å›¾æ‰€ç¤ºï¼š

![image-20200228220030725](å­¦ä¹ ç¬”è®°ï¼šStringTable.assets/image-20200228220030725.png)

## ä»å·²æœ‰å­—ç¬¦ä¸²åˆ›å»º

è¿™ç§åˆ›å»ºæ–¹å¼æœ€ä¸ºç®€å•ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„ä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å¼•ç”¨åŒä¸€ä¸ª`char[]`å¯¹è±¡ã€‚

```
String s1 = new String(new char[]{'a', 'b', 'c'});
String s2 = new String(s1);
```

å†…å­˜ç»“æ„å¦‚ä¸‹ï¼š

![image-20200228220535422](å­¦ä¹ ç¬”è®°ï¼šStringTable.assets/image-20200228220535422.png)

## å­—é¢é‡åˆ›å»º

è¿™ç§åˆ›å»ºæ–¹å¼æœ€ä¸ºæˆ‘ä»¬ç†Ÿæ‚‰ã€‚

```
public static void main(String[] args){
	String s = "abc";
} 
```

`â€œabcâ€`è¢«ç§°ä¸ºå­—ç¬¦ä¸²å­—é¢é‡ï¼ˆString literalï¼‰ï¼Œæ‹¥æœ‰éå¯¹è±¡ã€æ‡’åŠ è½½ã€ä¸é‡å¤ä¸‰ç‚¹ç‰¹æ€§ã€‚

### éå¯¹è±¡

ä¸¥æ ¼æ¥è¯´ï¼Œå­—é¢é‡åœ¨ä»£ç è¿è¡Œåˆ°å®ƒæ‰€åœ¨è¯­å¥ä¹‹å‰ï¼Œå®ƒè¿˜ä¸æ˜¯å­—ç¬¦ä¸²å¯¹è±¡ã€‚è¦ç†è§£ä»å­—é¢é‡ç¼–ç¨‹å­—ç¬¦ä¸²å¯¹è±¡çš„è¿‡ç¨‹ï¼Œéœ€è¦ä»å­—èŠ‚ç çš„è§’åº¦æ¥åˆ†æã€‚åœ¨ä¸Šé¢çš„javaä»£ç è¢«ç¼–è¯‘ä¸ºclassæ–‡ä»¶åï¼Œ`â€œabcâ€`å­˜å‚¨äºâ€œç±»æ–‡ä»¶å¸¸é‡æ± â€ä¸­ã€‚

```
Constant pool: //å¸¸é‡æ± 
	#1 = Methodref #19.#41   //java/lang/object."<init>"()
	#2 = String #42          //abc
	...
```

å½“classå®Œæˆç±»åŠ è½½åï¼Œ`â€œabcâ€`è¿™ä¸ªå­—é¢é‡è¢«å­˜å‚¨äºâ€œè¿è¡Œæ—¶å¸¸é‡æ± â€ï¼ˆå½’å±äºæ–¹æ³•åŒº/å…ƒç©ºé—´ï¼‰ä¸­ï¼Œå…¶ä¸­#1 #2éƒ½ä¼šè¢«ç¿»è¯‘ä¸ºè¿è¡Œæ—¶çœŸæ­£çš„å†…å­˜åœ°å€ã€‚

å†çœ‹ä¸€ä¸‹classä¸­mainæ–¹æ³•çš„å­—èŠ‚ç 

```
public static void main(java.lang.String[]); //
	descriptor: ([Ljava/lang/String;)V
	flags: ACC_PUBLIC, ACC_STATIC
	Code:
	  stack=1, locals=2, args_size=1
		0: 1dc #2
		2: astore_1
		3: return
		...
```

å°†æ¥mainæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå°±ä¼šæ‰§è¡Œé‡Œé¢çš„å­—èŠ‚ç æŒ‡ä»¤ï¼š

```
0: 1dc #2      //åˆ›å»ºå­—ç¬¦ä¸²å¸¸é‡åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­
2: astore_1    //å°†å­—ç¬¦ä¸²å¸¸é‡èµ‹å€¼ç»™å±€éƒ¨å˜é‡
3: return      //ä»æ–¹æ³•ä¸­è¿”å›
```

![image-20200228221916506](å­¦ä¹ ç¬”è®°ï¼šStringTable.assets/image-20200228221916506.png)

### æ‡’åŠ è½½

å½“ç¬¬ä¸€æ¬¡ç”¨åˆ°`â€œabc"`å­—é¢é‡æ—¶ï¼Œæ‰ä¼šåˆ›å»ºå¯¹åº”çš„å­—ç¬¦ä¸²å˜é‡ã€‚

å¯ä»¥åœ¨IDEAçš„debugç•Œé¢ä¸­çš„memoryå·¥å…·æ¥æŸ¥çœ‹å­—ç¬¦ä¸²å¯¹è±¡çš„æ•°é‡ï¼ˆä»¥Stringä¸ºå…³é”®å­—æŸ¥è¯¢ï¼‰

### ä¸é‡å¤

åŒä¸€ä¸ªç±»ä¸­çš„å€¼ç›¸åŒçš„å­—ç¬¦ä¸²å­—é¢é‡ï¼Œå…¶å®åªæœ‰ä¸€ä»½ã€‚

ä¸åŒçš„ç±»å¸¸é‡æ± æ˜¯ä¸ä¸€æ ·çš„ã€‚â€œç±»æ–‡ä»¶å˜é‡æ± â€åŒ…æ‹¬â€œè¿è¡Œæ—¶å¸¸é‡æ± â€éƒ½æ˜¯ä»¥ç±»ä¸ºå•ä½çš„ã€‚

è¿™æ—¶å€™è™½ç„¶â€œå­—é¢é‡â€æ˜¯ä¸¤ä»½ï¼Œä½†æ˜¯â€œå­—ç¬¦ä¸²å¯¹è±¡â€ä»…æœ‰ä¸€ä¸ªã€‚

## æ‹¼æ¥åˆ›å»º

å¯ä»¥é€šè¿‡+è¿ç®—ç¬¦é‡ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼ˆå…¶ä¸­ä¸€ä¸ªä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ç±»å‹ï¼‰æ‹¼æ¥ä¸ºä¸€ä¸ªæ–°å­—ç¬¦ä¸²ã€‚

```
//ä¾‹1
String s = "a" + "b";
//ä¾‹2
final String x1 = "b";
String s1 = "a" + x1;
//ä¾‹3
String x2 = "b";
String s2 = "a" + x2;
//ä¾‹4
String s3 = "a" + 1;
```

å…¶ä¸­ä¾‹1å’Œä¾‹2çš„åŸç†æ˜¯ä¸€æ ·çš„ï¼Œä¾‹3å’Œä¾‹4çš„åŸç†æ˜¯ä¸€æ ·çš„ã€‚

* ä¾‹1ï¼šå¹¶æ²¡æœ‰çœŸæ­£çš„æ‹¼æ¥æ“ä½œå‘ç”Ÿï¼Œä»æºç ç¼–è¯‘ä¸ºå­—èŠ‚ç æ—¶ï¼Œjavacå°±å·²ç»æŠŠ`â€œaâ€`å’Œ`"b"`ä¸²åœ¨ä¸€èµ·äº†ã€‚è¿™æ˜¯ä¸€ç§ç¼–è¯‘æœŸçš„ä¼˜åŒ–å¤„ç†
* ä¾‹2ï¼šx1æ˜¯å¸¸é‡ï¼Œå…¶å€¼ä¸å¯æ”¹å˜ï¼ˆå¹¶ä¸”å­—ç¬¦ä¸²çš„å†…å®¹æœ¬èº«ä¹Ÿä¸å¯å˜ï¼‰ï¼ŒåŒä¸Šã€‚
* ä¾‹3ï¼šx2æ˜¯å˜é‡ï¼Œä¸èƒ½åœ¨ç¼–è¯‘æœŸé—´ç¡®å®šå€¼ï¼Œæœ€åå­—ç¬¦ä¸²çš„+æ“ä½œç¬¦ä¼šè¢«è½¬åŒ–ä¸º`StringBuilder`æˆ–`StringBuffer`çš„`append`æ–¹æ³•ã€‚
* ä¾‹4ï¼šåŒä¸Šã€‚

å¯¹äºå­—ç¬¦ä¸²çš„+æ“ä½œç¬¦çš„è¯´æ˜

```
String x = "b";
String s = "a" + x; 

//ç­‰åŒäºä¸‹é¢è¿™å¥ï¼ˆåœ¨ç¼–è¯‘æ—¶ä¼šè¢«æ›¿æ¢ï¼‰
//StringBuilderå’ŒStringBufferçš„toStringæ–¹æ³•çš„å®ç°ï¼Œå°±æ˜¯åˆ©ç”¨å®ƒä»¬çš„valueå­—æ®µç”Ÿæˆæ–°çš„å­—ç¬¦ä¸²
String s1 = new StringBuilder().append("a").append(x).toString();
```

## JDK9ä¹‹åçš„æ”¹å˜

> æ³¨æ„ï¼šä»Java9å¼€å§‹ï¼Œä½¿ç”¨invokedynamicæŒ‡ä»¤æ‰©å±•äº†å­—ç¬¦ä¸²çš„æ‹¼æ¥çš„å®ç°æ–¹å¼

ä»JDK9å¼€å§‹ï¼ŒStringçš„å†…éƒ¨å­˜å‚¨æ–¹å¼ä»¥åŠæ‹¼æ¥æ–¹å¼å‘ç”Ÿäº†è¾ƒå¤§çš„æ”¹å˜ã€‚

* ä¸å†ä½¿ç”¨`char[]`ç²—ç³™ä½ å­—ç¬¦ï¼Œæ”¹ä¸ºäº†`byte[]`ï¼Œç›®çš„æ˜¯èŠ‚çº¦å†…å­˜ã€‚
* ä½¿ç”¨invokedynamicæŒ‡ä»¤æ‰©å±•äº†å­—ç¬¦ä¸²çš„æ‹¼æ¥çš„å®ç°æ–¹å¼ã€‚

### å†…å­˜ç»“æ„æ”¹å˜

ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²ä¸­ä»…æœ‰æ‹‰ä¸å­—ç¬¦æ—¶ï¼š

```
String s = new String (new byte[]{97, 98, 99});
```

![image-20200228224707273](å­¦ä¹ ç¬”è®°ï¼šStringTable.assets/image-20200228224707273.png)

ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²ä¸­æœ‰ä¸­æ–‡å­—ç¬¦

```
String s = new String(new byte[]{0xd5, (byte)0xc5},Charset.forName("gbk"));
```

![image-20200228225134510](å­¦ä¹ ç¬”è®°ï¼šStringTable.assets/image-20200228225134510.png)

ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²ä¸­æ—¢æœ‰ä¸­æ–‡å­—ç¬¦ä¹Ÿæœ‰æ‹‰ä¸å­—ç¬¦ï¼šï¼ˆè¿™æ—¶ä¼šæŠŠæ‰€æœ‰å­—ç¬¦è§†ä¸ºunicodeå¤„ç†ï¼‰

```
String s = new String(new byte[]{0xd5, (byte)0xc5, 97},Charset.forName("gbk"));
```

![image-20200228225258575](å­¦ä¹ ç¬”è®°ï¼šStringTable.assets/image-20200228225258575.png)

å…¶ä¸­coderå±æ€§ç”¨äºåŒºåˆ†å­—ç¬¦ä¸²çš„ç¼–ç ã€‚0è¡¨ç¤ºï¼ˆä»…æœ‰ï¼‰æ‹‰ä¸å­—ç¬¦ï¼Œ1è¡¨ç¤ºï¼ˆåŒ…å«ï¼‰unicodeå­—ç¬¦ã€‚

### æ‹¼æ¥æ–¹å¼çš„æ”¹å˜

ä¾‹å¦‚ï¼š

```
public static void main(String[] args){
	String x = "b";
	String s = "a" + x;
}
```

å¸¸é‡æ± 

```
Constant pool:
	#1 = Methodref #5.#22   //java/lang/object."<init>"()
	#2 = String #23         //b
	...
```

ä¸»æ–¹æ³•

```
public static void main(java.lang.String[]); //
	descriptor: ([Ljava/lang/String;)V
	flags: ACC_PUBLIC, ACC_STATIC
	Code:
	  stack=1, locals=2, args_size=1
		0: 1dc #2
		2: astore_1
		3: aload_1
		4: invokedynamic #3, 0
	[Ljava/lang/String;]Ljava/lang/String;
		9: astore_2
		10: return
		...
```

 å¯¹äºå­—ç¬¦ä¸²çš„+æ“ä½œç¬¦çš„è¯´æ˜

```
String x = "b";
String s = "a" + x;

//ç­‰åŒäºä¸‹é¢è¿™å¥ï¼ˆåœ¨ç¼–è¯‘æ—¶ä¼šè¢«æ›¿æ¢ï¼‰
//ç¼–è¯‘å™¨ä¼šæä¾›lookupï¼Œç”¨æ¥æŸ¥æ‰¾MethodHandle
MethodHandles.Lookup lookup = MethodHandles.lookup();
CallSite callSite = StringConcatFactory.makeConcatWithConstants(
    lookup,
    //æ–¹æ³•åï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆ
    "arbitrary",
    //æ–¹æ³•çš„ç­¾åï¼Œå‚æ•°åˆ†åˆ«ä¸ºè¿”å›å€¼ç±»å‹å’Œå‚æ•°ç±»å‹
    MethodType.methodType(String.class,String.class),
    //å…·ä½“å¤„æ–¹æ ¼å¼ï¼Œå…¶ä¸­ã€1è¡¨ç¤ºå˜é‡çš„å ä½ç¬¦ï¼Œç”¨æ¥è¢«xæ›¿ä»£
    "a\1"
);
//ç”¨æ¥åå°„æ‰§è¡Œæ‹¼æ¥æ–¹æ³•
String s = (String) callSite.getTarget().invoke(x);
```

 ä¸»è¦æ˜¯ä¸ºäº†å¯¹å­—ç¬¦ä¸²çš„æ‹¼æ¥åšå„ç§æ‰©å±•ä¼˜åŒ–ï¼Œå¤šäº†æ‰©å±•é€”å¾„ã€‚å…¶ä¸­æœ€ä¸ºé‡è¦çš„æ˜¯MethodHandleï¼Œå®ƒä½¿ç”¨äº†ç­–ç•¥æ¨¡å¼ç”Ÿæˆï¼ŒJDKæä¾›çš„æ‰€æœ‰ç­–ç•¥å¯ä»¥åœ¨StringconcatFactory.Strategeä¸­æ‰¾åˆ°ã€‚

| ç­–ç•¥å                | å†…éƒ¨è°ƒç”¨                                     | è§£é‡Š                                      |
| --------------------- | -------------------------------------------- | ----------------------------------------- |
| BC_SB                 | å­—ç¬¦ä¸²æ‹¼æ¥ç”ŸæˆStringBuilderä»£ç               | ç­‰ä»·äº`new StringBuilder()`               |
| BC_SB_SIZED           | å­—ç¬¦ä¸²æ‹¼æ¥ç”ŸæˆStringBuilderä»£ç               | ç­‰ä»·äº`new StringBuilder(n)`ï¼Œnä¸ºé¢„ä¼°å¤§å° |
| BC_SB_SIZED_EXACT     | å­—ç¬¦ä¸²æ‹¼æ¥ç”ŸæˆStringBuilderä»£ç               | ç­‰ä»·äº`new StringBuilder(n)`ï¼Œnä¸ºå‡†ç¡®å¤§å° |
| MH_SB_SIZED           | MethodHandleç”ŸæˆStringBuilderä»£ç             | ç­‰ä»·äº`new StringBuilder(n)`ï¼Œnä¸ºé¢„ä¼°å¤§å° |
| MH_SB_SIZED_EXACT     | MethodHandleç”ŸæˆStringBuilderä»£ç             | ç­‰ä»·äº`new StringBuilder(n)`ï¼Œnä¸ºå‡†ç¡®å¤§å° |
| MH_INLINE_SIZED_EXACT | MethodHandleå†…éƒ¨ä½¿ç”¨å­—èŠ‚æ•°ç»„ç›´æ¥æ„é€ å‡ºString | é»˜è®¤ç­–ç•¥                                  |

å¦‚æœæƒ³æ”¹å˜ç­–ç•¥ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶æ·»åŠ JVMå‚æ•°ï¼Œä¾‹å¦‚å°†ç­–ç•¥æ”¹ä¸ºBC_SBã€‚

```
-Djava.lang.invoke.stringConcat=BC_SB
-Djava.lang.invoke.stringConcat.debug=true
-Djava.lang.invoke.stringConcat.dumpClasses=åŒ¿åç±»å¯¼å‡ºè·¯å¾„
```

è¿˜æœ‰ä¸€ç§é€‰æ‹©ï¼Œæ˜¯åœ¨javacç¼–è¯‘æ—¶ä»ä½¿ç”¨1.5çš„æ–¹æ³•æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯é‡‡ç”¨invokedynamicï¼Œé‚£å°±æ˜¯åœ¨javacè¿è¡Œæ—¶åŠ ä¸Šå‚æ•°ï¼š

```
-XDstringConcat=inline
```

é»˜è®¤ç­–ç•¥ä¸ºMH_INLINE_SIZED_EXACTï¼Œä½¿ç”¨å­—èŠ‚æ•°ç»„ç›´æ¥æ„é€ å‡ºString

ä¾‹å¦‚æœ‰ä¸‹é¢çš„å­—ç¬¦ä¸²æ‹¼æ¥ä»£ç 

```
String x = "b"
String s = "a" + x + "c" + "d";
```

ä½¿ç”¨è¿™ä¸ªç­–ç•¥åï¼Œå†…éƒ¨ä¼šæ‰§è¡Œå¦‚ä¸‹ç­‰ä»·è°ƒç”¨ï¼š

```
String x = "b";
//é¢„å…ˆåˆ†é…å­—ç¬¦ä¸²éœ€è¦çš„å­—èŠ‚æ•°ç»„
byte[] buf = new byte[4];
//åˆ›å»ºæ–°å­—ç¬¦ä¸²ï¼Œè¿™æ—¶å†…éƒ¨å­—èŠ‚æ•°ç»„å€¼ä¸º[0, 0, 0, 0]
String s = StringConcatHelper.newString(buf, 0);
//æ‰§è¡Œæ‹¼æ¥æ“ä½œï¼Œå­—ç¬¦ä¸²å†…éƒ¨å­—èŠ‚æ•°ç»„å€¼å˜ä¸º[97, 0, 0 ,0]
StringConcatHelper.prepend(1,buf,"a");
//æ‰§è¡Œæ‹¼æ¥æ“ä½œï¼Œå­—ç¬¦ä¸²å†…éƒ¨å­—èŠ‚æ•°ç»„å€¼å˜ä¸º[97, 98, 0, 0]
StringConcatHelper.prepend(2, buf, x);
//æ‰§è¡Œæ‹¼æ¥æ“ä½œï¼Œå­—ç¬¦ä¸²å†…éƒ¨å­—èŠ‚æ•°ç»„å€¼ä¸º[97, 98, 99, 100]
//åˆ°æ­¤æ‹¼æ¥å®Œæ¯•
```

### æ³¨æ„

* StringCoconcatHelperå¯¹å¤–æ˜¯ä¸å¯è§çš„ï¼Œå› æ­¤æ— æ³•ç›´æ¥æµ‹è¯•ï¼Œåªèƒ½åå°„æµ‹è¯•ã€‚
* prependæ–¹æ³•å¯ä»¥ç›´æ¥ä¿®æ”¹å­—ç¬¦ä¸²ä¸­byteæ•°ç»„å±æ€§çš„å†…å®¹ã€‚è¿™æ˜¯å…è®¸çš„ï¼Œå› ä¸ºæ˜¯åŒä¸€ä¸ªbyteæ•°ç»„ã€‚

## æ¨¡ä»¿BC_SBç­–ç•¥

### æ–¹æ³•æ‰‹åŠ¨ç”Ÿæˆ

[StringConcatDemo.java](../src/main/java/com/windea/study/stringtable/StringConcatDemo1.java)

### å­—èŠ‚ç ç”Ÿæˆæ–¹æ³•

[StringConcatDemo2.java](../src/main/java/com/windea/study/stringtable/StringConcatDemo2.java)

JDK9å¯ä»¥é€‚é…ç”Ÿæˆä¸åŒçš„å‚æ•°ä¸ªæ•°ã€ç±»å‹çš„MethodHandleï¼ŒåŸç†å°±æ˜¯è¿™æ ·ã€‚

# å­—ç¬¦ä¸²ä¹‹å®¶â€”â€”StringTable

## å®¶å…»ä¸é‡ç”Ÿ

## æ”¶ç•™é‡ç”Ÿå­—ç¬¦ä¸²

## å®¶çš„å¥½å¤„

## å®¶çš„ä½ç½®

## internå‡ºé‡åŸç†

## G1å»é‡

## å®¶çš„å¤§å°

## å­—ç¬¦ä¸²ä¹‹æ­»
